<div class="water-meter">
    <div class="table">
        <div class="header">
            <div class="selector-and-filter">
                <mat-form-field class="selector" appearance="standard">
                    <mat-label>{{ 'PAGE.WATER_METER.DETAIL.SELECTOR.TEXT' | translate }}</mat-label>
                    <mat-select
                        matTooltip="{{ 'PAGE.WATER_METER.DETAIL.SELECTOR.TOOLTIP' | translate }}"
                        [(value)]="chunk"
                    >
                        <mat-option *ngFor="let chnk of chunks" value="{{ chnk }}" (click)="loadWaterMeterMeasures()">
                            {{ chnk }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Fecha Comienzo</mat-label>
                    <input
                        matInput
                        [matDatepicker]="pickerStart"
                        [formControl]="dateStart"
                        (dateChange)="loadWaterMeterMeasures()"
                    />
                    <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
                    <mat-datepicker #pickerStart></mat-datepicker>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Fecha Fin</mat-label>
                    <input
                        matInput
                        [matDatepicker]="pickerEnd"
                        [formControl]="dateEnd"
                        (dateChange)="loadWaterMeterMeasures()"
                    />
                    <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
                    <mat-datepicker #pickerEnd></mat-datepicker>
                </mat-form-field>
                <mat-form-field class="filter" appearance="standard">
                    <mat-label>m<sup>3</sup>, {{ 'PAGE.WATER_METER.DETAIL.FILTER.TEXT' | translate }}</mat-label>
                    <input
                        matInput
                        matTooltip="{{ 'PAGE.WATER_METER.DETAIL.FILTER.TEXT.TOOLTIP' | translate }}"
                        matTooltipPosition="right"
                        (keyup)="applyFilter()"
                        [formControl]="filter"
                    />
                    <button
                        matSuffix
                        mat-icon-button
                        matTooltip="{{ 'PAGE.WATER_METER.DETAIL.FILTER.TEXT.BUTTON_TOOLTIP' | translate }}"
                        *ngIf="filter.value.length > 0"
                        (click)="clearFilter()"
                    >
                        <mat-icon>close</mat-icon>
                    </button>
                </mat-form-field>
            </div>
            <div *ngIf="canAddReading">
                <button
                    mat-raised-button
                    color="primary"
                    class="button-reading"
                    matTooltip="{{ 'PAGE.WATER_METER.DETAIL.BUTTON.TEXT.TOOLTIP' | translate }}"
                    (click)="openMeasureDialog()"
                    disabled="{{ !waterMeterId }}"
                >
                    <mat-icon>alarm_add</mat-icon>
                    {{ 'PAGE.WATER_METER.DETAIL.BUTTON.TEXT' | translate }}
                </button>
            </div>
        </div>

        <div class="scroll">
            <table mat-table [dataSource]="dataSource">
                <ng-container matColumnDef="measurement">
                    <th mat-header-cell *matHeaderCellDef>measurement</th>
                    <td
                        mat-cell
                        *matCellDef="let element"
                        matTooltip="{{ 'PAGE.WATER_METER.DETAIL.TABLE.MEASUREMENT.TOOLTIP' | translate }}"
                    >
                        {{ element.measurement }}
                        <span matSuffix>m<sup>3</sup></span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="date">
                    <th mat-header-cell *matHeaderCellDef>date</th>
                    <td
                        mat-cell
                        *matCellDef="let element"
                        matTooltip="{{ 'PAGE.WATER_METER.DETAIL.TABLE.DATE.TOOLTIP' | translate }}"
                    >
                        {{ element.date | date: 'longDate' }} {{ element.date | date: 'shortTime' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="measurement_diff">
                    <th mat-header-cell *matHeaderCellDef>measurement_diff</th>
                    <td
                        mat-cell
                        *matCellDef="let element"
                        matTooltip="{{ 'PAGE.WATER_METER.DETAIL.TABLE.MEASUREMENT.TOOLTIP' | translate }}"
                    >
                        <span [ngClass]="!isOverflow(element) ? 'no-overflow' : 'overflow'"
                            >{{ element.measurement_diff }}<span matSuffix> L</span></span
                        >
                        / {{ element.max_daily_consumption }}<span matSuffix> L</span>
                    </td>
                </ng-container>

                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
        </div>

        <div [align]="'end'">

            <button mat-raised-button color="primary" (click)="fetchPrevious(pageIndex!)">
                <mat-icon>arrow_back_ios</mat-icon>
            </button>
            {{ pageIndex }} / {{ page }}
            <button mat-raised-button color="primary" (click)="fetchNext(pageIndex!)">
                <mat-icon>arrow_forward_ios</mat-icon>
            </button>
        </div>
    </div>
</div>
