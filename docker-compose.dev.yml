version: "3.8"

services:
  # Postgres Database
  db:
    container_name: postgres-db
    image: postgres
    ports:
      - 5432:5432
    env_file:
      - ./docker/dev/.env.db.dev
    networks:
      - backend

  # RabbitMQ - queue
  rabbitmq:
    container_name: rabbitmq
    hostname: rabbit
    image: rabbitmq:3-management
    ports:
      - 5672:5672
      # here, we can access rabbitmq management plugin
      - 15672:15672
    env_file:
      - ./docker/dev/.env.rabbit.dev
    networks:
      - backend

  # Django Backend server
  auth-backend:
    container_name: auth-backend
    hostname: auth-backend
    image: registry.gitlab.com/availa/proyectos/auth/backend/auth-be
    command: python manage.py runserver 0.0.0.0:8000
    ports:
      - 8000:8000
    volumes:
      - .:/availa
    env_file:
      - ./docker/dev/.env.be.dev
    depends_on:
      - db
      - rabbitmq
    networks:
      - backend
  subscription-backend:
    container_name: subscription-backend
    hostname: subscription-backend
    image: registry.gitlab.com/availa/proyectos/subscription/backend/subscription-be
    command: python manage.py runserver 0.0.0.0:8000
    ports:
      - 8001:8000
    volumes:
      - .:/availa
    env_file:
      - ./docker/dev/.env.be.dev
    depends_on:
      - db
      - rabbitmq
    networks:
      - backend
  contact-book-backend:
    container_name: contact-book-backend
    hostname: contact-book-backend
    image: registry.gitlab.com/availa/proyectos/contact-book/backend/contact-book-be
    command: python manage.py runserver 0.0.0.0:8000
    ports:
      - 8002:8000
    volumes:
      - .:/availa
    env_file:
      - ./docker/dev/.env.be.dev
    depends_on:
      - db
      - rabbitmq
    networks:
      - backend
  agube-backend:
    container_name: agube-backend
    hostname: agube-backend
    image: registry.gitlab.com/availa/proyectos/agube/backend/agube-be
    command: python manage.py runserver 0.0.0.0:8000
    ports:
      - 8003:8000
      - 5555:5555
    volumes:
      - .:/availa
    env_file:
      - ./docker/dev/.env.be.dev
    depends_on:
      - db
      - rabbitmq
    networks:
      - backend
  task-backend:
    container_name: task-backend
    hostname: task-backend
    image: registry.gitlab.com/availa/proyectos/task/backend/task-be
    command: python manage.py runserver 0.0.0.0:8000
    ports:
      - 8004:8000
    volumes:
      - .:/availa
    env_file:
      - ./docker/dev/.env.be.dev
    depends_on:
      - db
      - rabbitmq
    networks:
      - backend

networks:
  backend:
    driver: bridge
